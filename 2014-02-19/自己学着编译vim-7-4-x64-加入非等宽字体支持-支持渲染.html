<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1, maximum-scale=1">
<meta name="renderer" content="webkit">
<meta name="google" value="notranslate">
<meta name="robots" content="index,follow">


<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linx&#39;s Solution">
<meta name="twitter:description" content="记录解决方案">
<meta name="twitter:image:src" content="http://linx.run/images/photo.jpg">

<meta property="og:url" content="http://linx.run">
<meta property="og:title" content="Linx&#39;s Solution">
<meta property="og:description" content="记录解决方案">
<meta property="og:site_name" content="Linx&#39;s Solution">
<meta property="og:image" content="http://linx.run/images/photo.jpg">
<meta property="og:type" content="website">
<meta name="robots" content="noodp">

<meta itemprop="name" content="Linx&#39;s Solution">
<meta itemprop="description" content="记录解决方案">
<meta itemprop="image" content="http://linx.run/images/photo.jpg">

<link rel="canonical" href="http://linx.run">

<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-itouch-icon" href="/favicon.ico">
<link rel="stylesheet" href="/bundle/index.css">
<script type="text/javascript">
    var timeSinceLang = {
        year: '',
        month: '',
        day: '',
        hour: '',
        minute: '',
        second: ''
    };
    var root = '';
</script>


        <meta name="keywords" content="windows,">
        <meta name="description" content="自己学着编译VIM 7.4 X64 加入非等宽字体支持，支持渲染">
        <meta name="author" content="linx">
        <title>自己学着编译VIM 7.4 X64 加入非等宽字体支持，支持渲染</title>
    </head>
    <body>
        <article class="container">
            <header class="header-wrap">
  <a class="index" href="/">
    <img class="logo" src="/images/photo.jpg" />
    Linx&#39;s Solution
  </a>
  <ul class="menu">
      <li class="menu-item"><a href="/tools.html"></a></li>
      <li class="menu-item"><a href="/archive.html"></a></li>
      <li class="menu-item"><a href="/tag.html"></a></li>
      <li class="menu-item"><a href="/atom.xml"></a></li>
      <li class="menu-item"><a href="/friends.html"></a></li>
      <li class="menu-item"><a href="/about.html"></a></li>

  </ul>
</header>

            <article class="main article">
                <h1 class="title">自己学着编译VIM 7.4 X64 加入非等宽字体支持，支持渲染</h1>
                <section class="info">
                    <span class="avatar" style="background-image: url(/images/photo.jpg);"></span>
                    <a class="name" href="/about.me.html">linx</a>
                    
                    <span class="date" data-time="1392739380"><span class="from"></span></span>
                    
                    <span class="tags"><a class="tag" href="/tag/windows/index.html">windows</a></span>
                </section>
                <article class="content"><p><a href="http://bucunzai.net/2010/10/vim/" _src="http://bucunzai.net/2010/10/vim/"><font face="文泉驿微米黑"><a href="http://bucunzai.net/2010/10/vim/">http://bucunzai.net/2010/10/vim/</a></font></a><div><span style="color: inherit; font-size: 10.5pt; line-height: 1.5;"><font face="文泉驿微米黑"><a href="http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html" _src="http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html"><a href="http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html">http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html</a></a> </font></span></div><div><font face="文泉驿微米黑">主要参考以上两处的方法</font></div><div><font face="文泉驿微米黑"><a href="http://ftp://ftp.vim.org/pub/vim/patches/7.4/" _src="http://ftp://ftp.vim.org/pub/vim/patches/7.4/"><a href="ftp://ftp.vim.org/pub/vim/patches/7.4/">ftp://ftp.vim.org/pub/vim/patches/7.4/</a></a> </font></div><div><font face="文泉驿微米黑">VIM的源码补丁</font></div><div><font face="文泉驿微米黑"><a href="http://ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2" _src="http://ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2"><a href="ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2">ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2</a></a> </font></div><div><font face="文泉驿微米黑">源码</font></div><div><font face="文泉驿微米黑"><br></font></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">源码下载</font></span></b></div><div><font face="文泉驿微米黑"><a href="http://mercurial.selenic.com/downloads/" _src="http://mercurial.selenic.com/downloads/"><a href="http://mercurial.selenic.com/downloads/">http://mercurial.selenic.com/downloads/</a></a> </font></div><div><font face="文泉驿微米黑">源码下载工具</font></div><div><div><font face="文泉驿微米黑"><br></font></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><code><div style="background-color: rgb(0, 0, 0); color: rgb(0, 255, 0); border: 1px solid rgb(242, 242, 242); margin-left: auto; margin-right: auto; padding: 3px; font-family: 'Courier New';"><div>hg clone https<font color="#00ff00">:</font><font color="#00ff00">/</font><font color="#00ff00">/</font>vim.googlecode.com<font color="#00ff00">/</font>hg<font color="#00ff00">/</font> vim &amp;nbsp;<font color="#00ff00">/</font><font color="#00ff00"><em></font>后面的vim表示保存的当前目录下的vim文件夹<font color="#00ff00"></em></font><font color="#00ff00">/</font><br>hg pull &amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;<font color="#00ff00">/</font><font color="#00ff00"><em></font>由于是第一次下载，所以以下两行没啥用<font color="#00ff00"></em></font><font color="#00ff00">/</font><br>hg update</div></div></code></div></code></div></div><div><font face="文泉驿微米黑"><br></font></div><div><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><b><font face="文泉驿微米黑">打开编辑</font></b></span></div><div><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><b><font face="文泉驿微米黑">vimsrcgui_w32.c</font></b></span></div><div><font face="文泉驿微米黑"><br></font></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑"><font color="#008000">/* On NT, tell the font renderer not to &ldquo;help&rdquo; us with Hebrew and Arabic<br>&amp;nbsp;* text.&amp;nbsp; This doesn&rsquo;t work in 9x, so we have to deal with it manually on<br>* those systems. <em>/</font><br><br><font color="#0000FF"><b>if</b></font> (os_version.dwPlatformId <font color="#333399">==</font> VER_PLATFORM_WIN32_NT)<br>foptions <font color="#333399">|=</font> ETO_IGNORELANGUAGE;<br>&amp;nbsp; <font color="#008000">/</em> 这两行注释掉<em>/</font></font></div></div></code></div><div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;">打开vimsrcos_mswin.c</span></b></div><div><br></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-family: 'Courier New'; font-size: 12px;"><div>#<font color="#0000FF"><b>ifndef</b></font> FEAT_PROPORTIONAL_FONTS<br>&amp;nbsp;&amp;nbsp;&amp;nbsp; <font color="#008000">/</em> Ignore non-monospace fonts without further ado */</font><br>&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>&amp;nbsp;<font color="#0000FF"><b>if</b></font> ((ntm<font color="#333399">-</font><font color="#333399">&amp;gt;</font>tmPitchAndFamily <font color="#333399">&amp;</font> <font color="#6E00AA">1</font>) <font color="#333399">!=</font> <font color="#6E00AA">0</font>)<br>&amp;nbsp;&amp;nbsp;&amp;nbsp; <font color="#0000FF"><b>return</b></font> <font color="#6E00AA">1</font>;<br><font color="#008000">/<em>注释掉这两行（或者return 0，不知道行不，没有尝试）</em>/</font><br><br>#<font color="#0000FF"><b>endif</b></font></div></div></code></div></div><div>这里参考<a href="http://xbeta.info/gvim-powerword-ciba.htm" _src="http://xbeta.info/gvim-powerword-ciba.htm"><a href="http://xbeta.info/gvim-powerword-ciba.htm">http://xbeta.info/gvim-powerword-ciba.htm</a></a> </div><div><br></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">编译过程中出现</font></span></b></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">vimsrcObjGOY**<em>pathdef.c</font></span></b></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">编辑文件最后面</font></span></b></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑">char_u <font color="#333399"></em></font>compiled_user <font color="#333399">=</font> (char_u <font color="#333399"><em></font>)<font color="#FF00BF">&ldquo;名字&rdquo;</font>;<br>char_u <font color="#333399"></em></font>compiled_sys <font color="#333399">=</font> (char_u <font color="#333399">*</font>)<font color="#FF00BF">&ldquo;系统名称&rdquo;</font>;</font></div></div></code></div><div><font face="文泉驿微米黑"><br></font></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">打开</font></span></b></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">vimsrcvim.h</font></span></b></div><div><div><font face="文泉驿微米黑">在开头加上这一行（#include语句之后）：</font></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑">#<font color="#0000FF"><b>define</b></font> MODIFIED_BY <font color="#FF00BF">&ldquo;修改人名称 &ldquo;</font></font></div></div></code></div></div><div><font face="文泉驿微米黑"><br></font></div><div><span data-wiz-span="data-wiz-span" style="font-size: 11pt;"><b><font face="文泉驿微米黑">修改适合vs2013编译器的makefile文件Make_mvc.mak</font></b></span></div><div><font face="文泉驿微米黑"><br></font></div><div><div><font face="文泉驿微米黑">这个文件在源码的src目录下面，打开它。</font></div><div><font face="文泉驿微米黑">在# Derive version of VC being used from nmake if not specified 这个区域下面，加入最新的vs2013的vc编译器的定义，否则makefile会拒绝编译，因为版本不匹配。</font></div><div><font face="文泉驿微米黑">大约是424行，这个地方：</font></div><div><font face="文泉驿微米黑">!if &ldquo;<span class="math inline">\((_NMAKE_VER)&quot; == &quot;11.00.60610.1&quot;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;文泉驿微米黑&quot;&gt;MSVCVER = 11.0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;文泉驿微米黑&quot;&gt;!endif&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;文泉驿微米黑&quot;&gt;在上面这一段下面加上如下的这一段：&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;文泉驿微米黑&quot;&gt;!if &quot;\)</span>(_NMAKE_VER)&rdquo; == &ldquo;12.00.21005.1&rdquo;</font></div><div><font face="文泉驿微米黑">MSVCVER = 11.0</font></div><div><font face="文泉驿微米黑">!endif</font></div><div><font face="文泉驿微米黑">加上的这一段是为了加入vs2013的vc编译器版本定义的支持。</font></div></div><div><font face="文泉驿微米黑"><br></font></div><div><div><font face="文泉驿微米黑">611行，把SUBSYSTEM = windows改成 SUBSYSTEM = windows,5.01</font></div><div><font face="文泉驿微米黑">639行，把SUBSYSTEM = console改成 SUBSYSTEM = console,5.01</font></div><div><font face="文泉驿微米黑">改这两行是为了让vs2013的编译器编译出来的exe支持在win2000 sp1及以上的版本系统运行，不改的话，生成的exe只支持在vista及以上的系统运行</font></div></div><div><font face="文泉驿微米黑"><br></font></div><div><font color="#ff0000" face="文泉驿微米黑">PS：7.4版本的源码新版本会直接加入支持，我的是VIsual Studio 2012 即MSVCVER=11.0，不需要修改，此处为附加</font></div><div><font face="文泉驿微米黑"><br></font></div><div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">最后编译64位的gvim.exe。</font></span></b></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">以下为vimsrcbigvim64.bat的内容</font></div><div><code><div style="background-color: rgb(0, 0, 0); color: rgb(0, 255, 0); border: 1px solid rgb(242, 242, 242); margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑">nmake <font color="#00ff00">-</font>f Make_mvc.mak FEATURES<font color="#00ff00">=</font>HUGE GUI<font color="#00ff00">=</font>yes OLE<font color="#00ff00">=</font>yes CPUNR<font color="#00ff00">=</font>Intel64 CPU<font color="#00ff00">=</font>ALPHA IME<font color="#00ff00">=</font>yes GIME<font color="#00ff00">=</font>yes CSCOPE<font color="#00ff00">=</font>yes SNIFF<font color="#00ff00">=</font>yes POSTSCRIPT<font color="#00ff00">=</font>yes <font color="#00ff00">%</font><font color="#00ff00">1</font> USERNAME<font color="#00ff00">=</font>SUMIT USERDOMAIN<font color="#00ff00">=</font>SUMIT<font color="#00ff00">-</font>PC<br>pause</font></div></div></code></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">CPU= &amp;nbsp;这一项实在不知道是什么，原先用AMD64，后来提示只有i386和ALPHA，我直接把i386排除了。不过这样后面会提示LINK错误，说ALPHA参数无效，必须为x86 x64之类的，也没在意。CPUNR不知道是干啥的</font></div><div><font face="文泉驿微米黑"><br></font></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">打开 VS2013 x64 本机工具命令提示（开始菜单中），执行bigvim64.bat，</font></span></b></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">生成gvim.exe之后拷贝到VIM目录运行它，使用:ve看，如果第二行是</font></div><div><font face="文泉驿微米黑">MS-Windows 64-bit GUI version with OLE&amp;nbsp; 就说明成功了。</font></div></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑"><img src="fb5aed06-8522-498a-b450-6f140d8c1c62_files/236ad6007bf68d48cbabd6dfa9f1691d.png" border="0"></font></div><div><font face="文泉驿微米黑">附上效果图，可以中英文分别定义一种字体了，并且Mactype渲染效果不错<br></font><div><font face="文泉驿微米黑"><img src="http://sumit.space.lc/wp-content/uploads/2014/02/wpid-828969e4f2309e6fc0d9b9b347f41b1a_ed74c95d163b7af39313f6dc232f1f45.png" border="0"></font><div><font face="文泉驿微米黑"><br></font></div></div></div><div><font face="文泉驿微米黑">补丁已经到183了，比ftp上的还多一个，看来google code上的源码比较新啊</font></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">PS：没有加入其他语言的支持，因为电脑上没装，所以懒得了</font></div><br /><br /><div><a title="来自为知笔记(Wiz)" href="http://www.wiz.cn/i/13dc3a5d">来自为知笔记(Wiz)</a></div><br /><br /></p>
</article>
                <section class="author">
                    <div class="avatar" style="background-image: url(/images/photo.jpg);"></div>
                    <a class="name" href="/about.me.html">linx</a>
                    <div class="intro">记录我自己的各种解决方案</div>
                </section>
                <section class="recommend">
                    
                    <section class="nav prev more">
                        <div class="head"></div>
                        <a class="link" href="/2014-03-03/nexus-4-enable-google-play-complete-edition-google-now-in-china.html">Nexus 4 Enable Google Play Complete Edition &amp;amp; Google Now in China</a>
                    </section>
                    
                    
                    <section class="nav next more">
                        <div class="head"></div>
                        <a class="link" href="/2014-02-18/android-4-4-%e5%bc%80%e5%90%afart%e6%a8%a1%e5%bc%8f.html">Android 4.4 开启ART模式</a>
                    </section>
                    
                </section>
                

            </article>
        </article>
        <footer class="footer">
    <span class="copyright">
        Linx&#39;s Solution ©
        <script type="text/javascript">
            document.write(new Date().getFullYear());
        </script>
    </span>

    <span class="publish">Powered by <a href="https://linx.run" target="_blank">Ink</a></span>
</footer>

        <script src="/bundle/index.js"></script>
        <div id="go_top" style="position:fixed; LEFT:85%; bottom:50px" >
            <svg width="50" height="50" viewBox="0 0 878 1024">
                <path fill="#8a8a8a" d="M733.714 511.429c0-9.714-3.429-18.857-10.286-25.714l-258.857-258.857c-6.857-6.857-16-10.286-25.714-10.286s-18.857 3.429-25.714 10.286l-258.857 258.857c-6.857 6.857-10.286 16-10.286 25.714s3.429 18.857 10.286 25.714l52 52c6.857 6.857 16 10.286 25.714 10.286s18.857-3.429 25.714-10.286l108-108v286.857c0 20 16.571 36.571 36.571 36.571h73.143c20 0 36.571-16.571 36.571-36.571v-286.857l108 108c6.857 6.857 16 10.857 25.714 10.857s18.857-4 25.714-10.857l52-52c6.857-6.857 10.286-16 10.286-25.714zM877.714 512c0 242.286-196.571 438.857-438.857 438.857s-438.857-196.571-438.857-438.857 196.571-438.857 438.857-438.857 438.857 196.571 438.857 438.857z"></path>
            </svg>
        </div>
    </body>
</html>
