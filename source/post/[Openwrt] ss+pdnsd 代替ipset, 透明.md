title: '[Openwrt] ss+pdnsd 代替ipset, 透明'
date: "2015-10-03 13:41:17"
update: ""
author: me
tags:
- OPENWRT
categories:
- OPENWRT
topic: ""
cover: ""
draft: false
preview: ""
top: false
type: ""
hide: false
toc: false
image: ""
subtitle: ""
config: {}


---



之前用 `pdnsd` 突然之间就觉得不好用了，那时候还完全不熟悉这个家伙，前几天买了个带USB的wr841n，
再次折腾的时候，由于折腾半天没搞定 `dnsmasq+ipset` 的配置，搞到最后还上不了网了，然后偶然就发现 `pdnsd` 比`ipset`要方便

配置过程：
先PS一下：我需要的自动穿越应该是这样的，可以手动添加域名（而不是ip，因此排除ChinaDNS），我自己发现相应的域名之后，自己添加，不需要那么智能，因为我看的网站也不多么

1. 惯例先给 openwrt 上网，使用桥接，`搜索网络`，然后 `加入网络` , 然后关键的一步 `重置无线配置` 把这个勾去掉，不去掉的话，确认完原来的无线就没有了，要重新添加。我刷的明月的固件，因此开始就已经有无线（基于lan接口），没必要再添加一次，特别是如果无线连接到路由器那就绝对不能勾选了（因为桥接的时候肯定要把路由放在`奇怪`的位置）。如果无线不能上网，有线可以上网
请检查，无线对应的接口配置的网络那里是不是勾选了lan

2. Shadowsocks 
  
   * 启动前等待改为1或0，因为我不多拨
   * 代理方式为忽略列表，这样启动完成后就可以看是不是成功了
   * UDP转发关掉
   * 点一次 `保存&应用`就可以了，点一次 `保存&应用`就可以了，点一次 `保存&应用`就可以了重要的事说三遍，然而我点了好多次....
3. pdnsd 
   * 排除国内DNS解析 这个行最前面加#
   * 上级 dns 的 ip 地址自己选，支持自定义端口，本来想用我自己的，后来发现 208.67.220.220 ，速度其实还行，我之前一直觉得opendns挺慢的
   * gfw配置文件里 server=/域名/127.0.0.1#1053这样的格式添加即可，不需要配置iptables，方便多了
  * 保存应用
4. DNS转发设置为 127.0.0.1#1053，OK搞定
