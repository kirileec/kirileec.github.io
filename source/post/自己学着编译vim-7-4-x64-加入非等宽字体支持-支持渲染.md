title: 自己学着编译VIM 7.4 X64 加入非等宽字体支持，支持渲染
date: "2014-02-19 00:03:00"
update: ""
author: me
tags:
- windows
categories:
- windows
topic: ""
cover: ""
draft: false
preview: ""
top: false
type: ""
hide: false
toc: false
image: ""
subtitle: ""
config: {}


---



<a href="http://bucunzai.net/2010/10/vim/" _src="http://bucunzai.net/2010/10/vim/"><font face="文泉驿微米黑">http://bucunzai.net/2010/10/vim/</font></a><div><span style="color: inherit; font-size: 10.5pt; line-height: 1.5;"><font face="文泉驿微米黑"><a href="http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html" _src="http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html">http://blog.sina.com.cn/s/blog_5f2e119b0101s37n.html</a> </font></span></div><!--more--><div><font face="文泉驿微米黑">主要参考以上两处的方法</font></div><div><font face="文泉驿微米黑"><a href="http://ftp://ftp.vim.org/pub/vim/patches/7.4/" _src="http://ftp://ftp.vim.org/pub/vim/patches/7.4/">ftp://ftp.vim.org/pub/vim/patches/7.4/</a> </font></div><div><font face="文泉驿微米黑">VIM的源码补丁</font></div><div><font face="文泉驿微米黑"><a href="http://ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2" _src="http://ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2">ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2</a> </font></div><div><font face="文泉驿微米黑">源码</font></div><div><font face="文泉驿微米黑"><br></font></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">源码下载</font></span></b></div><div><font face="文泉驿微米黑"><a href="http://mercurial.selenic.com/downloads/" _src="http://mercurial.selenic.com/downloads/">http://mercurial.selenic.com/downloads/</a> </font></div><div><font face="文泉驿微米黑">源码下载工具</font></div><div><div><font face="文泉驿微米黑"><br></font></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><code><div style="background-color: rgb(0, 0, 0); color: rgb(0, 255, 0); border: 1px solid rgb(242, 242, 242); margin-left: auto; margin-right: auto; padding: 3px; font-family: 'Courier New';"><div>hg clone https<font color="#00ff00">:</font><font color="#00ff00">/</font><font color="#00ff00">/</font>vim.googlecode.com<font color="#00ff00">/</font>hg<font color="#00ff00">/</font> vim &nbsp;<font color="#00ff00">/</font><font color="#00ff00">*</font>后面的vim表示保存的当前目录下的vim文件夹<font color="#00ff00">*</font><font color="#00ff00">/</font><br>hg pull &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<font color="#00ff00">/</font><font color="#00ff00">*</font>由于是第一次下载，所以以下两行没啥用<font color="#00ff00">*</font><font color="#00ff00">/</font><br>hg update</div></div></code></div></code></div></div><div><font face="文泉驿微米黑"><br></font></div><div><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><b><font face="文泉驿微米黑">打开编辑</font></b></span></div><div><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><b><font face="文泉驿微米黑">vimsrcgui_w32.c</font></b></span></div><div><font face="文泉驿微米黑"><br></font></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑"><font color="#008000">/* On NT, tell the font renderer not to "help" us with Hebrew and Arabic<br>&nbsp;* text.&nbsp; This doesn't work in 9x, so we have to deal with it manually on<br>* those systems. */</font><br><br><font color="#0000FF"><b>if</b></font> (os_version.dwPlatformId <font color="#333399">==</font> VER_PLATFORM_WIN32_NT)<br>foptions <font color="#333399">|=</font> ETO_IGNORELANGUAGE;<br>&nbsp; <font color="#008000">/* 这两行注释掉*/</font></font></div></div></code></div><div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;">打开vimsrcos_mswin.c</span></b></div><div><br></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-family: 'Courier New'; font-size: 12px;"><div>#<font color="#0000FF"><b>ifndef</b></font> FEAT_PROPORTIONAL_FONTS<br>&nbsp;&nbsp;&nbsp; <font color="#008000">/* Ignore non-monospace fonts without further ado */</font><br>&nbsp;&nbsp;&nbsp;<br>&nbsp;<font color="#0000FF"><b>if</b></font> ((ntm<font color="#333399">-</font><font color="#333399">&gt;</font>tmPitchAndFamily <font color="#333399">&amp;</font> <font color="#6E00AA">1</font>) <font color="#333399">!=</font> <font color="#6E00AA">0</font>)<br>&nbsp;&nbsp;&nbsp; <font color="#0000FF"><b>return</b></font> <font color="#6E00AA">1</font>;<br><font color="#008000">/*注释掉这两行（或者return 0，不知道行不，没有尝试）*/</font><br><br>#<font color="#0000FF"><b>endif</b></font></div></div></code></div></div><div>这里参考<a href="http://xbeta.info/gvim-powerword-ciba.htm" _src="http://xbeta.info/gvim-powerword-ciba.htm">http://xbeta.info/gvim-powerword-ciba.htm</a> </div><div><br></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">编译过程中出现</font></span></b></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">vimsrcObjGOY***pathdef.c</font></span></b></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">编辑文件最后面</font></span></b></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑">char_u <font color="#333399">*</font>compiled_user <font color="#333399">=</font> (char_u <font color="#333399">*</font>)<font color="#FF00BF">"名字"</font>;<br>char_u <font color="#333399">*</font>compiled_sys <font color="#333399">=</font> (char_u <font color="#333399">*</font>)<font color="#FF00BF">"系统名称"</font>;</font></div></div></code></div><div><font face="文泉驿微米黑"><br></font></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">打开</font></span></b></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">vimsrcvim.h</font></span></b></div><div><div><font face="文泉驿微米黑">在开头加上这一行（#include语句之后）：</font></div><div><code><div style="border: 1px solid black; margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑">#<font color="#0000FF"><b>define</b></font> MODIFIED_BY <font color="#FF00BF">"修改人名称 "</font></font></div></div></code></div></div><div><font face="文泉驿微米黑"><br></font></div><div><span data-wiz-span="data-wiz-span" style="font-size: 11pt;"><b><font face="文泉驿微米黑">修改适合vs2013编译器的makefile文件Make_mvc.mak</font></b></span></div><div><font face="文泉驿微米黑"><br></font></div><div><div><font face="文泉驿微米黑">这个文件在源码的src目录下面，打开它。</font></div><div><font face="文泉驿微米黑">在# Derive version of VC being used from nmake if not specified 这个区域下面，加入最新的vs2013的vc编译器的定义，否则makefile会拒绝编译，因为版本不匹配。</font></div><div><font face="文泉驿微米黑">大约是424行，这个地方：</font></div><div><font face="文泉驿微米黑">!if "$(_NMAKE_VER)" == "11.00.60610.1"</font></div><div><font face="文泉驿微米黑">MSVCVER = 11.0</font></div><div><font face="文泉驿微米黑">!endif</font></div><div><font face="文泉驿微米黑">在上面这一段下面加上如下的这一段：</font></div><div><font face="文泉驿微米黑">!if "$(_NMAKE_VER)" == "12.00.21005.1"</font></div><div><font face="文泉驿微米黑">MSVCVER = 11.0</font></div><div><font face="文泉驿微米黑">!endif</font></div><div><font face="文泉驿微米黑">加上的这一段是为了加入vs2013的vc编译器版本定义的支持。</font></div></div><div><font face="文泉驿微米黑"><br></font></div><div><div><font face="文泉驿微米黑">611行，把SUBSYSTEM = windows改成 SUBSYSTEM = windows,5.01</font></div><div><font face="文泉驿微米黑">639行，把SUBSYSTEM = console改成 SUBSYSTEM = console,5.01</font></div><div><font face="文泉驿微米黑">改这两行是为了让vs2013的编译器编译出来的exe支持在win2000 sp1及以上的版本系统运行，不改的话，生成的exe只支持在vista及以上的系统运行</font></div></div><div><font face="文泉驿微米黑"><br></font></div><div><font color="#ff0000" face="文泉驿微米黑">PS：7.4版本的源码新版本会直接加入支持，我的是VIsual Studio 2012 即MSVCVER=11.0，不需要修改，此处为附加</font></div><div><font face="文泉驿微米黑"><br></font></div><div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">最后编译64位的gvim.exe。</font></span></b></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">以下为vimsrcbigvim64.bat的内容</font></div><div><code><div style="background-color: rgb(0, 0, 0); color: rgb(0, 255, 0); border: 1px solid rgb(242, 242, 242); margin-left: auto; margin-right: auto; padding: 3px; font-size: 12px;"><div><font face="文泉驿微米黑">nmake <font color="#00ff00">-</font>f Make_mvc.mak FEATURES<font color="#00ff00">=</font>HUGE GUI<font color="#00ff00">=</font>yes OLE<font color="#00ff00">=</font>yes CPUNR<font color="#00ff00">=</font>Intel64 CPU<font color="#00ff00">=</font>ALPHA IME<font color="#00ff00">=</font>yes GIME<font color="#00ff00">=</font>yes CSCOPE<font color="#00ff00">=</font>yes SNIFF<font color="#00ff00">=</font>yes POSTSCRIPT<font color="#00ff00">=</font>yes <font color="#00ff00">%</font><font color="#00ff00">1</font> USERNAME<font color="#00ff00">=</font>SUMIT USERDOMAIN<font color="#00ff00">=</font>SUMIT<font color="#00ff00">-</font>PC<br>pause</font></div></div></code></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">CPU= &nbsp;这一项实在不知道是什么，原先用AMD64，后来提示只有i386和ALPHA，我直接把i386排除了。不过这样后面会提示LINK错误，说ALPHA参数无效，必须为x86 x64之类的，也没在意。CPUNR不知道是干啥的</font></div><div><font face="文泉驿微米黑"><br></font></div><div><b><span data-wiz-span="data-wiz-span" style="font-size: 12pt;"><font face="文泉驿微米黑">打开 VS2013 x64 本机工具命令提示（开始菜单中），执行bigvim64.bat，</font></span></b></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">生成gvim.exe之后拷贝到VIM目录运行它，使用:ve看，如果第二行是</font></div><div><font face="文泉驿微米黑">MS-Windows 64-bit GUI version with OLE&nbsp; 就说明成功了。</font></div></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑"><img src="fb5aed06-8522-498a-b450-6f140d8c1c62_files/236ad6007bf68d48cbabd6dfa9f1691d.png" border="0"></font></div><div><font face="文泉驿微米黑">附上效果图，可以中英文分别定义一种字体了，并且Mactype渲染效果不错<br></font><div><font face="文泉驿微米黑"><img src="http://sumit.space.lc/wp-content/uploads/2014/02/wpid-828969e4f2309e6fc0d9b9b347f41b1a_ed74c95d163b7af39313f6dc232f1f45.png" border="0"></font><div><font face="文泉驿微米黑"><br></font></div></div></div><div><font face="文泉驿微米黑">补丁已经到183了，比ftp上的还多一个，看来google code上的源码比较新啊</font></div><div><font face="文泉驿微米黑"><br></font></div><div><font face="文泉驿微米黑">PS：没有加入其他语言的支持，因为电脑上没装，所以懒得了</font></div><br /><br /><div><a title="来自为知笔记(Wiz)" href="http://www.wiz.cn/i/13dc3a5d">来自为知笔记(Wiz)</a></div><br /><br />
